<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Title</title>
    <link href="css/common.css" rel="stylesheet" type="text/css"/>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <!--<meta name="viewport" content="width=750, minimum-scale=1.92, maximum-scale=1.92, user-scalable=no">-->
</head>
<body>
<div class="x-newbiepageauth" style="position:absolute;top:600px;left:66px;z-index: 0">
    <form id="registerForm" onsubmit="return checkForm()">
        <div>
            <div class="width-100">
                <input id="usernameTx" type="text" class="x-textbox" placeholder="请输入用户名">
            </div>
        </div>
        <div>
            <div class="width-100">
                <input id="phoneNumberTx" maxlength="11" type="text" class="x-textbox" placeholder="请输入常用手机号">
            </div>
        </div>
        <div>
            <div class="width-100">
                <input id="passwordTx" maxlength="20" minlength="6" type="password" class="x-textbox" placeholder="请输入6-20位登录密码(不支持空格)">
            </div>
        </div>
        <div>
            <div class="x-col width-50">
                <input id="yzmTx" type="text" class="x-textbox" placeholder="请输入短信验证码">
            </div>
            <div class="x-col width-50">
                <div id="getYzmBt" >
                    <button  onclick="getYzm()" class="x-button sms-code-button" type="button" style="background-image: url(img/get_yzm_button.png);" ></button>
                </div>
                <div id="reGetYzmBt" style="display:none;">
                    <button  id="reGetYzm" class="x-button sms-code-button" type="button" style="background-image: url(img/reGetYzm.png);font-size: 20px;color: #FFFFFF" >30秒后重新获取</button>
                </div>
            </div>
        </div>
        <!--<div>-->
            <!--<div class="x-col width-50">-->
                <!--<input type="text" class="x-textbox" placeholder="请输入短信验证码">-->
            <!--</div>-->
            <!--<div class="x-col width-50">-->
                <!--<div >-->
                    <!--<button  onclick="getYzm()" class="x-button sms-code-button" type="button" style="background-image: url(button.png);" ></button>-->
                <!--</div>-->
                <!--<div  style="display:none;">-->
                    <!--<button  onclick="reGetYzm()" class="x-button sms-code-button" type="button" style="background-image: url(phone.jpg);" ></button>-->
                <!--</div>-->
            <!--</div>-->
        <!--</div>-->
        <div class="x-center" id="red-tip" hidden>
           <span id="red-tip-span" style="color: rgb(255, 255, 255);"></span>
        </div>
        <button  class="x-button register-button" type="submit" style="background-image: url(img/register_button.png);"></button>
        <div class="x-center">
           <span style="color: rgb(255, 255, 255);">
               <i >✓</i>
           </span>
            <a href="http://www.gollton.com/safe/agreement" style="color: rgb(255, 255, 255);">同意《用户服务协议》</a>
        </div>
    </form>
</div>
<div class="x-multibackgroundcontainer">
    <center>
        <div>
            <img src="img/background.jpg">
        </div>
    </center>
</div>
<script type="text/javascript">
    function shipei() {
        var phoneScale = parseInt(window.screen.width) / 750;
        document.write('<meta name="viewport" content="width=750, minimum-scale=' + phoneScale + ', maximum-scale=' + phoneScale + ', user-scalable=no">');
    }
    shipei();
    var form = document.getElementById('registerForm');
    var phoneNumber = document.getElementById('phoneNumberTx');
    var password = document.getElementById('passwordTx');
    var getYzmBt = document.getElementById('getYzmBt');
    var reGetYzmBt = document.getElementById('reGetYzmBt');
    var redTip = document.getElementById("red-tip");
    var redTipSpan = document.getElementById("red-tip-span")
    var usernameTx = document.getElementById("usernameTx")
    var reGetYzmBt1 = document.getElementById("reGetYzm");
    var yzmTx = document.getElementById("yzmTx")
    // var u = navigator.userAgent;
    // alert('u：'+u);
    // var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Adr') > -1; //android终端
    // var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端
    // alert('是否是Android：'+isAndroid);
    // alert('是否是iOS：'+isiOS);
    function checkForm() {
        if (usernameTx.value.length == 0){
            redTip.hidden = false
            redTipSpan.innerHTML = "用户名不能为空"
            return false;
        }
        if (phoneNumber.value.length == 0){
            redTip.hidden = false
            redTipSpan.innerHTML = "手机号不能为空"
            return false;
        }
        if (password.value.length == 0){
            redTip.hidden = false
            redTipSpan.innerHTML = "密码不能为空"
            return false;
        }
        if (yzmTx.value.length == 0){
            yzmTx.hidden = false
            yzmTx.innerHTML = "验证码不能为空"
            return false;
        }
        if (password.value.length <6 || password.value.length>20){
            redTip.hidden = false
            redTipSpan.innerHTML = "密码长度不正确"
            return false;
        }
        if (!isPoneAvailable(phoneNumber.value)){
            redTip.hidden = false
            redTipSpan.innerHTML = "手机号格式不正确"
            return false;
        }
        // registerRequest(usernameTx.value,phoneNumber.value,password.value,yzmTx.value)
        return false;
    }
    function getYzm() {
        if (phoneNumber.value.length == 0){
            alert("手机号不能为空")
            return;
        }
        if (!isPoneAvailable(phoneNumber.value)){
            alert("手机号格式不正确")
            return;
        }
        // relogin(phoneNumber.value);
    }
    // function getPrice() {
    //     var
    //         js = document.createElement('script'),
    //         head = document.getElementsByTagName('head')[0];
    //     js.src = 'http://api.money.126.net/data/feed/0000001,1399001?callback=refreshPrice';
    //     head.appendChild(js);
    // }
    // function refreshPrice(data) {
    //     // var p = document.getElementById('test-jsonp');
    //     yzmTx.value = '当前价格：' +
    //         data['0000001'].name +': ' +
    //         data['0000001'].price + '；' +
    //         data['1399001'].name + ': ' +
    //         data['1399001'].price;
    // }
    // function success(text) {
    //     phoneNumber.value = text;
    // }
    //
    // function fail(code) {
    //     phoneNumber.value = 'Error code: ' + code;
    // }

    function isPoneAvailable(str) {
        var myreg=/^[1][3,4,5,7,8][0-9]{9}$/;
        if (!myreg.test(str)) {
            return false;
        } else {
            return true;
        }
    }
    var c = 31
    var t
    function timedCount()
    {
        clearTimeout(t)
        // reGetYzmBt1.value=c
        c=c - 1
        if (c>=1){
            reGetYzmBt1.innerHTML = c+"秒后重新获取"
        }else{
            c = 31
            reGetYzmBt.style.display = "none"
            getYzmBt.style.display = ""
        }
        t=setTimeout("timedCount()",1000)
    }
    // //发送POST请求跳转到指定页面
    // function httpPost(URL, PARAMS) {
    //     form.action = URL;
    //     form.method = "post";
    //     // form.style.display = "none";
    //
    //     for (var x in PARAMS) {
    //         var opt = document.createElement("textarea");
    //         opt.name = x;
    //         opt.value = PARAMS[x];
    //         form.appendChild(opt);
    //     }
    //
    //     document.body.appendChild(form);
    //     form.submit();
    //
    //     return false;
    // }
    function relogin(account){

        var d = {"account":account};
        var jqxhr = $.ajax('http://tm.gollton.com/wap/system/reglogin', {
            // xhrFields: {
            //     withCredentials: true    // 前端设置是否带cookie
            // },
            // crossDomain: true,
            type: "post",
            // dataType: 'jsonp',
            data: d,
        }).done(function (data) {
            alert('成功, 收到的数据: ' + JSON.stringify(data));
            sendYzm();
        }).fail(function (xhr, status) {
            alert('失败: ' + xhr.status + ', 原因: ' + status);
        }).always(function () {
        });

    }
    function registerRequest(account,phoneCode,password) {
        var d = {"account":account,
        "phone_code":phoneCode,
        "password":password};
        var jqxhr = $.ajax('http://m.gollton.com/wap/system/register2', {
            type: "post",
            // dataType: 'json',
            data: d,
        }).done(function (data) {
            alert('成功, 收到的数据: ' + JSON.stringify(data));
            window.location.href='xiazai.html'
        }).fail(function (xhr, status) {
            alert('失败: ' + xhr.status + ', 原因: ' + status);
        }).always(function () {
        });

    }
    function sendYzm(account) {
        var d = {"type":"reg"};
        var jqxhr = $.ajax('http://m.gollton.com/wap/system/sendsms', {
            type: "post",
            // dataType: 'json',
            data: d,
        }).done(function (data) {
            alert('成功, 收到的数据: ' + JSON.stringify(data));
            reGetYzmBt.style.display = ""
            getYzmBt.style.display = "none"
            timedCount()
        }).fail(function (xhr, status) {
            alert('失败: ' + xhr.status + ', 原因: ' + status);
        }).always(function () {
        });

    }
</script>
</body>
</html>